import{_ as M,c as n,h as q,a as e,b as d,r as R,g as u,n as c,t as r,F as b,j as y,w as h,e as m,k as f,d as L,v,u as _,q as A,o as i}from"./index-urv8ZhUX.js";import{N as D}from"./NavBar-DUvPfABS.js";const p=A.create({baseURL:"https://speedlab-agile-a0ayh9gvbaaxdddt.eastus2-01.azurewebsites.net/api"});p.interceptors.request.use(a=>{const t=localStorage.getItem("token");return t&&(a.headers.Authorization=`Bearer ${t}`),a});const C={name:"LeaveRequests",components:{NavBar:D},data(){return{activeTab:this.user?.isMember?"my-requests":"pending-approvals",myRequests:[],pendingApprovals:[],loading:!1,submitting:!1,showRequestModal:!1,error:null,leaveForm:{squad_id:"",leave_type:"",start_date:"",end_date:"",reason:""},approvalModal:{show:!1,request:null,action:null,comments:""}}},computed:{user(){return _().user},canApprove(){return this.user?.role==="admin"||this.user?.role==="squad_lead"}},async mounted(){await this.loadData()},methods:{async loadData(){this.loading=!0;try{await this.loadMyRequests(),this.canApprove&&await this.loadPendingApprovals()}catch(a){console.error("Error loading data:",a)}finally{this.loading=!1}},async loadMyRequests(){try{const a=await p.get("/leave-requests");this.myRequests=a.data.data||a.data}catch(a){console.error("Error loading requests:",a)}},async loadPendingApprovals(){try{const a=await p.get("/leave-requests/pending-approvals");this.pendingApprovals=a.data.data||a.data}catch(a){console.error("Error loading approvals:",a)}},async submitLeaveRequest(){this.error=null,this.submitting=!0;try{await p.post("/leave-requests",this.leaveForm),this.closeRequestModal(),await this.loadMyRequests()}catch(a){this.error=a.response?.data?.message||"Failed to submit request"}finally{this.submitting=!1}},showApprovalModal(a,t){this.approvalModal={show:!0,request:a,action:t,comments:""}},async handleApproval(){this.submitting=!0;try{this.approvalModal.action==="approve"?await p.post(`/leave-requests/${this.approvalModal.request.id}/approve`,{comments:this.approvalModal.comments}):await p.post(`/leave-requests/${this.approvalModal.request.id}/reject`,{rejection_reason:this.approvalModal.comments}),this.closeApprovalModal(),await this.loadData()}catch{alert("Failed to process approval")}finally{this.submitting=!1}},async cancelRequest(a){if(confirm("Are you sure you want to cancel this request?"))try{await p.delete(`/leave-requests/${a}`),await this.loadMyRequests()}catch{alert("Failed to cancel request")}},editRequest(a){this.leaveForm={leave_type:a.leave_type,start_date:a.start_date,end_date:a.end_date,reason:a.reason},this.showRequestModal=!0},closeRequestModal(){this.showRequestModal=!1,this.leaveForm={leave_type:"",start_date:"",end_date:"",reason:""},this.error=null},closeApprovalModal(){this.approvalModal={show:!1,request:null,action:null,comments:""}},getLeaveTypeLabel(a){return{vacation:"🏖️ Vacation",sick:"🤒 Sick Leave",public_holiday:"🎉 Public Holiday",training:"📚 Training",other:"📋 Other"}[a]||a},getStatusClass(a){return{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"}[a]||"bg-gray-100 text-gray-800"},formatDate(a){return new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},formatDateTime(a){return new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},calculateDuration(a){const t=new Date(a.start_date),x=new Date(a.end_date);return Math.ceil((x-t)/(1e3*60*60*24))+1},getInitials(a){return a?.split(" ").map(t=>t[0]).join("").toUpperCase()||"??"},handleLogout(){_().logout(),this.$router.push("/login")}}},S={class:"min-h-screen bg-gray-50"},j={class:"px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8"},F={class:"flex items-center justify-between mb-8"},T={class:"mb-6 border-b border-gray-200"},V={class:"flex space-x-8"},z={key:0,class:"px-2 py-1 ml-2 text-xs text-blue-600 bg-blue-100 rounded-full"},B={key:0,class:"px-2 py-1 ml-2 text-xs text-red-600 bg-red-100 rounded-full"},N={key:0},P={key:0,class:"py-12 text-center"},U={key:1,class:"py-12 text-center"},E={key:2,class:"space-y-4"},H={class:"flex items-start justify-between"},I={class:"flex-1"},O={class:"flex items-center gap-3 mb-2"},Y={class:"text-lg font-semibold text-gray-900"},G={class:"mb-3 text-sm text-gray-600"},J={class:"grid grid-cols-2 gap-4 text-sm"},K={class:"font-medium text-gray-900"},Q={class:"font-medium text-gray-900"},W={class:"font-medium text-gray-900"},X={class:"font-medium text-gray-900"},Z={key:0,class:"pt-4 mt-4 border-t"},$={class:"flex items-center gap-2"},ee={key:0,class:"w-5 h-5 text-green-500",fill:"currentColor",viewBox:"0 0 20 20"},te={key:1,class:"w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},se={class:"text-sm text-gray-600"},oe={class:"font-medium"},ae={key:0,class:"mt-2 text-sm italic text-gray-600"},le={key:0,class:"flex gap-2"},re=["onClick"],ne=["onClick"],ie={key:1},de={key:0,class:"py-12 text-center"},ue={key:1,class:"py-12 text-center"},pe={key:2,class:"space-y-4"},me={class:"flex items-start justify-between mb-4"},ce={class:"flex items-center gap-3"},ve={class:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-full"},ge={class:"font-semibold text-blue-600"},be={class:"text-lg font-semibold text-gray-900"},ye={class:"text-sm text-gray-500"},xe={class:"p-4 mb-4 rounded-lg bg-gray-50"},he={class:"mb-2 text-sm font-medium text-gray-700"},fe={class:"mb-3 text-sm text-gray-600"},_e={class:"grid grid-cols-3 gap-4 text-sm"},we={class:"font-medium text-gray-900"},ke={class:"font-medium text-gray-900"},Me={class:"font-medium text-gray-900"},qe={class:"flex gap-3"},Re=["onClick"],Le=["onClick"],Ae={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"},De={class:"w-full max-w-lg p-6 bg-white rounded-xl"},Ce=["value"],Se={class:"grid grid-cols-2 gap-4"},je=["min"],Fe={key:0,class:"p-4 text-red-700 border-l-4 border-red-500 rounded bg-red-50"},Te={class:"text-sm"},Ve={class:"flex gap-3 mt-6"},ze=["disabled"],Be=["disabled"],Ne={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"},Pe={class:"w-full max-w-lg p-6 bg-white rounded-xl"},Ue={class:"mb-6 text-2xl font-semibold text-gray-900"},Ee={class:"p-4 mb-6 rounded-lg bg-gray-50"},He={class:"mb-1 text-sm text-gray-600"},Ie={class:"font-medium text-gray-900"},Oe={class:"mt-2 text-sm text-gray-600"},Ye={class:"block mb-1 text-sm font-medium text-gray-700"},Ge=["required","placeholder"],Je={class:"flex gap-3"},Ke=["disabled"],Qe=["disabled"];function We(a,t,x,w,o,l){const k=R("NavBar");return i(),n("div",S,[q(k),e("div",j,[e("div",F,[t[14]||(t[14]=e("div",null,[e("h2",{class:"text-3xl font-bold text-gray-900"},"Leave Requests"),e("p",{class:"mt-1 text-gray-600"}," Manage your leave requests and approvals ")],-1)),e("button",{onClick:t[0]||(t[0]=s=>o.showRequestModal=!0),class:"flex items-center px-6 py-3 font-semibold text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"},[...t[13]||(t[13]=[e("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1),u(" Request Leave ",-1)])])]),e("div",T,[e("nav",V,[l.user.isMember?(i(),n("button",{key:0,onClick:t[1]||(t[1]=s=>o.activeTab="my-requests"),class:c(["py-4 px-1 border-b-2 font-medium text-sm transition",o.activeTab==="my-requests"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[t[15]||(t[15]=u(" My Requests ",-1)),o.myRequests.length>0?(i(),n("span",z,r(o.myRequests.length),1)):d("",!0)],2)):d("",!0),l.canApprove?(i(),n("button",{key:1,onClick:t[2]||(t[2]=s=>o.activeTab="pending-approvals"),class:c(["py-4 px-1 border-b-2 font-medium text-sm transition",o.activeTab==="pending-approvals"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[t[16]||(t[16]=u(" Pending Approvals ",-1)),o.pendingApprovals.length>0?(i(),n("span",B,r(o.pendingApprovals.length),1)):d("",!0)],2)):d("",!0)])]),o.activeTab==="my-requests"?(i(),n("div",N,[o.loading?(i(),n("div",P,[...t[17]||(t[17]=[e("div",{class:"inline-block w-12 h-12 border-4 border-blue-500 rounded-full animate-spin border-t-transparent"},null,-1),e("p",{class:"mt-4 text-gray-500"},"Loading requests...",-1)])])):o.myRequests.length===0?(i(),n("div",U,[...t[18]||(t[18]=[e("svg",{class:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),e("h3",{class:"mt-4 text-lg font-medium text-gray-900"}," No leave requests ",-1),e("p",{class:"mt-2 text-gray-500"}," Submit your first leave request to get started ",-1)])])):(i(),n("div",E,[(i(!0),n(b,null,y(o.myRequests,s=>(i(),n("div",{key:s.id,class:"p-6 transition bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md"},[e("div",H,[e("div",I,[e("div",O,[e("h3",Y,r(l.getLeaveTypeLabel(s.leave_type)),1),e("span",{class:c(["px-3 py-1 text-xs font-medium rounded-full",l.getStatusClass(s.status)])},r(s.status),3)]),e("p",G,r(s.reason),1),e("div",J,[e("div",null,[t[19]||(t[19]=e("p",{class:"text-gray-500"},"Start Date",-1)),e("p",K,r(l.formatDate(s.start_date)),1)]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-gray-500"},"End Date",-1)),e("p",Q,r(l.formatDate(s.end_date)),1)]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-gray-500"},"Duration",-1)),e("p",W,r(l.calculateDuration(s))+" days ",1)]),e("div",null,[t[22]||(t[22]=e("p",{class:"text-gray-500"},"Submitted",-1)),e("p",X,r(l.formatDateTime(s.created_at)),1)])]),s.approval?(i(),n("div",Z,[e("div",$,[s.status==="approved"?(i(),n("svg",ee,[...t[23]||(t[23]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):s.status==="rejected"?(i(),n("svg",te,[...t[24]||(t[24]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])])):d("",!0),e("p",se,[u(r(s.status==="approved"?"Approved":"Rejected")+" by ",1),e("span",oe,r(s.approval.approver?.name),1),u(" on "+r(l.formatDateTime(s.approval.approved_at||s.approval.rejected_at)),1)])]),s.approval.comments?(i(),n("p",ae,' "'+r(s.approval.comments)+'" ',1)):d("",!0)])):d("",!0)]),s.status==="pending"?(i(),n("div",le,[e("button",{onClick:g=>l.editRequest(s),class:"text-blue-600 hover:text-blue-700",title:"Edit"},[...t[25]||(t[25]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])],8,re),e("button",{onClick:g=>l.cancelRequest(s.id),class:"text-red-600 hover:text-red-700",title:"Cancel"},[...t[26]||(t[26]=[e("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],8,ne)])):d("",!0)])]))),128))]))])):d("",!0),o.activeTab==="pending-approvals"&&l.canApprove?(i(),n("div",ie,[o.loading?(i(),n("div",de,[...t[27]||(t[27]=[e("div",{class:"inline-block w-12 h-12 border-4 border-blue-500 rounded-full animate-spin border-t-transparent"},null,-1),e("p",{class:"mt-4 text-gray-500"},"Loading approvals...",-1)])])):o.pendingApprovals.length===0?(i(),n("div",ue,[...t[28]||(t[28]=[e("svg",{class:"w-16 h-16 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"All caught up!",-1),e("p",{class:"mt-2 text-gray-500"},"No pending leave requests to approve",-1)])])):(i(),n("div",pe,[(i(!0),n(b,null,y(o.pendingApprovals,s=>(i(),n("div",{key:s.id,class:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm"},[e("div",me,[e("div",ce,[e("div",ve,[e("span",ge,r(l.getInitials(s.user?.name)),1)]),e("div",null,[e("h3",be,r(s.user?.name),1),e("p",ye,r(s.user?.email),1)])]),t[29]||(t[29]=e("span",{class:"px-3 py-1 text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full"}," Pending Approval ",-1))]),e("div",xe,[e("p",he,r(l.getLeaveTypeLabel(s.leave_type)),1),e("p",fe,r(s.reason),1),e("div",_e,[e("div",null,[t[30]||(t[30]=e("p",{class:"text-gray-500"},"Start Date",-1)),e("p",we,r(l.formatDate(s.start_date)),1)]),e("div",null,[t[31]||(t[31]=e("p",{class:"text-gray-500"},"End Date",-1)),e("p",ke,r(l.formatDate(s.end_date)),1)]),e("div",null,[t[32]||(t[32]=e("p",{class:"text-gray-500"},"Duration",-1)),e("p",Me,r(l.calculateDuration(s))+" days ",1)])])]),e("div",qe,[e("button",{onClick:g=>l.showApprovalModal(s,"approve"),class:"flex-1 px-4 py-2 font-medium text-white transition bg-green-600 rounded-lg hover:bg-green-700"}," Approve ",8,Re),e("button",{onClick:g=>l.showApprovalModal(s,"reject"),class:"flex-1 px-4 py-2 font-medium text-white transition bg-red-600 rounded-lg hover:bg-red-700"}," Reject ",8,Le)])]))),128))]))])):d("",!0)]),o.showRequestModal?(i(),n("div",Ae,[e("div",De,[t[40]||(t[40]=e("h3",{class:"mb-6 text-2xl font-semibold text-gray-900"},"Request Leave",-1)),e("form",{onSubmit:t[9]||(t[9]=h((...s)=>l.submitLeaveRequest&&l.submitLeaveRequest(...s),["prevent"])),class:"space-y-4"},[e("div",null,[t[34]||(t[34]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700"},[u(" Your Squad "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.leaveForm.squad_id=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[t[33]||(t[33]=e("option",{value:""},"Please choose squad",-1)),(i(!0),n(b,null,y(l.user.squads,s=>(i(),n("option",{value:s.id},r(s.name),9,Ce))),256))],512),[[f,o.leaveForm.squad_id]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700"},[u(" Leave Type "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.leaveForm.leave_type=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...t[35]||(t[35]=[L('<option value="">Select leave type</option><option value="vacation">Vacation</option><option value="sick">Sick Leave</option><option value="public_holiday">Public Holiday</option><option value="training">Training</option><option value="other">Other</option>',6)])],512),[[f,o.leaveForm.leave_type]])]),e("div",Se,[e("div",null,[t[37]||(t[37]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700"},[u(" Start Date "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>o.leaveForm.start_date=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,512),[[v,o.leaveForm.start_date]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700"},[u(" End Date "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.leaveForm.end_date=s),type:"date",required:"",min:o.leaveForm.start_date,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},null,8,je),[[v,o.leaveForm.end_date]])])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block mb-1 text-sm font-medium text-gray-700"},[u(" Reason "),e("span",{class:"text-red-500"},"*")],-1)),m(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.leaveForm.reason=s),rows:"4",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Please provide a reason for your leave request..."},null,512),[[v,o.leaveForm.reason]])]),o.error?(i(),n("div",Fe,[e("p",Te,r(o.error),1)])):d("",!0),e("div",Ve,[e("button",{type:"button",onClick:t[8]||(t[8]=(...s)=>l.closeRequestModal&&l.closeRequestModal(...s)),class:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:o.submitting}," Cancel ",8,ze),e("button",{type:"submit",class:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700",disabled:o.submitting},r(o.submitting?"Submitting...":"Submit Request"),9,Be)])],32)])])):d("",!0),o.approvalModal.show?(i(),n("div",Ne,[e("div",Pe,[e("h3",Ue,r(o.approvalModal.action==="approve"?"Approve":"Reject")+" Leave Request ",1),e("div",Ee,[e("p",He,r(o.approvalModal.request?.user?.name),1),e("p",Ie,r(l.getLeaveTypeLabel(o.approvalModal.request?.leave_type)),1),e("p",Oe,r(l.formatDate(o.approvalModal.request?.start_date))+" - "+r(l.formatDate(o.approvalModal.request?.end_date)),1)]),e("form",{onSubmit:t[12]||(t[12]=h((...s)=>l.handleApproval&&l.handleApproval(...s),["prevent"])),class:"space-y-4"},[e("div",null,[e("label",Ye," Comments "+r(o.approvalModal.action==="reject"?"(Required)":"(Optional)"),1),m(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=s=>o.approvalModal.comments=s),rows:"4",required:o.approvalModal.action==="reject",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:o.approvalModal.action==="approve"?"Add any notes...":"Please provide a reason for rejection..."},null,8,Ge),[[v,o.approvalModal.comments]])]),e("div",Je,[e("button",{type:"button",onClick:t[11]||(t[11]=(...s)=>l.closeApprovalModal&&l.closeApprovalModal(...s)),class:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:o.submitting}," Cancel ",8,Ke),e("button",{type:"submit",class:c(["flex-1 px-4 py-2 rounded-lg text-white font-medium",o.approvalModal.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"]),disabled:o.submitting},r(o.submitting?"Processing...":o.approvalModal.action==="approve"?"Approve":"Reject"),11,Qe)])],32)])])):d("",!0)])}const $e=M(C,[["render",We]]);export{$e as default};
