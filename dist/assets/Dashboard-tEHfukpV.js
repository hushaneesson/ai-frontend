import{l as _,m as h,_ as C,c as l,h as A,a as t,b as u,r as I,t as r,n as y,g as f,e as m,k as x,F as p,j as k,d as S,v as b,u as w,o as d}from"./index-ZSASEHEe.js";import{N as M}from"./NavBar-8mTwG486.js";const g=_("attendance",{state:()=>({todayAttendance:null,presenceBoard:null,attendanceHistory:[],stats:null,loading:!1,error:null}),getters:{isCheckedInToday:s=>s.todayAttendance&&s.todayAttendance.length>0,currentCheckIn:s=>s.todayAttendance?.[0]||null,hasCheckedOut:s=>s.currentCheckIn?.check_out_time!=null},actions:{async fetchTodayAttendance(){this.loading=!0,this.error=null;try{const s=await h.getToday();s.data.success&&(this.todayAttendance=s.data.data)}catch(s){this.error=s.response?.data?.message||"Failed to fetch attendance"}finally{this.loading=!1}},async checkIn(s){this.loading=!0,this.error=null;try{const e=await h.checkIn(s);if(e.data.success)return await this.fetchTodayAttendance(),e.data.data}catch(e){throw this.error=e.response?.data?.message||"Check-in failed",e}finally{this.loading=!1}},async checkOut(s={}){this.loading=!0,this.error=null;try{const e=await h.checkOut(s);if(e.data.success)return await this.fetchTodayAttendance(),e.data.data}catch(e){throw this.error=e.response?.data?.message||"Check-out failed",e}finally{this.loading=!1}},async updateWorkMode(s){this.loading=!0,this.error=null;try{if(this.todayAttendance?.id){const e=await h.update(this.todayAttendance.id,{work_mode:s});if(e.data.success)return await this.fetchTodayAttendance(),e.data.data}}catch(e){throw this.error=e.response?.data?.message||"Failed to update work mode",e}finally{this.loading=!1}},async fetchSquadPresenceBoard(s){this.loading=!0,this.error=null;try{const e=await h.getSquadToday(s);e.data.success&&(this.presenceBoard=e.data.data)}catch(e){this.error=e.response?.data?.message||"Failed to fetch presence board"}finally{this.loading=!1}},async fetchAttendanceHistory(s={}){this.loading=!0,this.error=null;try{const e=await h.getAll(s);e.data.success&&(this.attendanceHistory=e.data.data)}catch(e){this.error=e.response?.data?.message||"Failed to fetch history"}finally{this.loading=!1}},async fetchStats(s){this.loading=!0,this.error=null;try{const e=await h.getStats(s);e.data.success&&(this.stats=e.data.data)}catch(e){this.error=e.response?.data?.message||"Failed to fetch stats"}finally{this.loading=!1}}}}),O={name:"Dashboard",components:{NavBar:M},data(){return{loading:!1,showCheckInModal:!1,showCheckOutModal:!1,checkInForm:{squad_id:"",work_mode:"office",event_type:"",notes:""},checkOutForm:{notes:""},stats:{daysPresent:0,totalHours:0,avgHours:0,remoteDays:0}}},computed:{user(){return w().user},todayAttendance(){const s=g();return this.checkOutForm.attendance_id=s.todayAttendance?.id,s.todayAttendance},recentAttendance(){return g().attendanceHistory},isCheckedIn(){return this.todayAttendance?.check_in_time&&!this.todayAttendance?.check_out_time}},async mounted(){await this.loadData()},methods:{async loadData(){this.loading=!0;try{const s=g();await s.fetchTodayAttendance(),await s.fetchAttendanceHistory(),await this.fetchStats()}catch(s){console.error("Error loading data:",s)}finally{this.loading=!1}},async fetchStats(){const s=this.recentAttendance.filter(i=>{const c=new Date(i.date),a=new Date;return a.setDate(a.getDate()-7),c>=a});this.stats.daysPresent=s.length,this.stats.remoteDays=s.filter(i=>i.work_mode==="remote").length;const e=s.reduce((i,c)=>{if(c.check_out_time){const a=this.calculateHours(c);return i+parseFloat(a)*60}return i},0);this.stats.totalHours=Math.round(e/60*10)/10,this.stats.avgHours=s.length>0?Math.round(e/s.length/60*10)/10:0},async handleCheckIn(){this.loading=!0;try{await g().checkIn(this.checkInForm),this.showCheckInModal=!1,this.checkInForm={work_mode:"office",event_type:"",notes:""},await this.loadData()}catch{alert("Already checked in today for this squad or an error occurred.")}finally{this.loading=!1}},async handleCheckOut(){this.loading=!0;try{await g().checkOut(this.checkOutForm),this.showCheckOutModal=!1,this.checkOutForm={notes:""},await this.loadData()}catch{alert("Failed to check out. Please try again.")}finally{this.loading=!1}},async updateWorkMode(){if(this.isCheckedIn)try{await g().updateWorkMode(this.todayAttendance.work_mode)}catch{alert("Failed to update work mode")}},handleLogout(){w().logout(),this.$router.push("/login")},getCurrentDate(){const s={weekday:"long",year:"numeric",month:"long",day:"numeric"};return new Date().toLocaleDateString("en-US",s)},formatDate(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},formatTime(s){return s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"-"},calculateHours(s){if(!s.check_in_time||!s.check_out_time)return"-";const e=new Date(s.check_in_time),c=new Date(s.check_out_time)-e,a=Math.floor(c/1e3/60/60),o=Math.floor(c/1e3/60%60);return`${a}h ${o}m`},calculateCurrentHours(){if(!this.todayAttendance?.check_in_time)return"0h 0m";const s=new Date(this.todayAttendance.check_in_time),i=new Date-s,c=Math.floor(i/1e3/60/60),a=Math.floor(i/1e3/60%60);return`${c}h ${a}m`},getWorkModeLabel(s){return{office:"🏢 Office",remote:"🏠 Remote",client_site:"👥 Client",ooo:"🚫 OOO"}[s]||s},getWorkModeClass(s){return{office:"bg-blue-100 text-blue-800",remote:"bg-purple-100 text-purple-800",client_site:"bg-green-100 text-green-800",ooo:"bg-gray-100 text-gray-800"}[s]||"bg-gray-100 text-gray-800"}}},D={class:"min-h-screen bg-gray-50"},F={class:"px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8"},H={class:"mb-8"},T={class:"text-3xl font-bold text-gray-900"},V={class:"mt-1 text-gray-600"},L={class:"grid grid-cols-1 gap-6 mb-8 lg:grid-cols-2"},B={class:"p-6 bg-white border border-gray-200 shadow-sm rounded-xl"},W={key:0,class:"mb-6"},z={class:"flex items-center justify-between mb-4"},j={key:0,class:"w-6 h-6 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},N={key:1,class:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20"},P={key:0,class:"space-y-2"},U={class:"flex justify-between text-sm"},q={class:"font-medium text-gray-900"},R={key:0,class:"flex justify-between text-sm"},E={class:"font-medium text-gray-900"},G={key:1,class:"flex justify-between pt-2 text-sm border-t"},J={class:"font-semibold text-blue-600"},K={class:"space-y-3"},Q=["disabled"],X=["disabled"],Y={key:1,class:"pt-4 mt-4 border-t"},Z=["disabled"],$={class:"p-6 bg-white border border-gray-200 shadow-sm rounded-xl"},ee={class:"grid grid-cols-2 gap-4"},te={class:"p-4 rounded-lg bg-blue-50"},se={class:"mt-2 text-3xl font-bold text-blue-900"},oe={class:"p-4 rounded-lg bg-green-50"},ae={class:"mt-2 text-3xl font-bold text-green-900"},ne={class:"p-4 rounded-lg bg-yellow-50"},re={class:"mt-2 text-3xl font-bold text-yellow-900"},le={class:"p-4 rounded-lg bg-purple-50"},de={class:"mt-2 text-3xl font-bold text-purple-900"},ie={class:"p-6 bg-white border border-gray-200 shadow-sm rounded-xl"},ce={key:0,class:"py-8 text-center"},ue={key:1,class:"py-8 text-center text-gray-500"},he={key:2,class:"overflow-x-auto"},me={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-white divide-y divide-gray-200"},ye={class:"px-6 py-4 text-sm text-gray-900 whitespace-nowrap"},xe={class:"px-6 py-4 text-sm text-gray-900 whitespace-nowrap"},fe={class:"px-6 py-4 text-sm text-gray-900 whitespace-nowrap"},pe={class:"px-6 py-4 text-sm text-gray-900 whitespace-nowrap"},ke={class:"px-6 py-4 text-sm whitespace-nowrap"},be={class:"px-6 py-4 text-sm whitespace-nowrap"},we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"},ve={class:"w-full max-w-md p-6 bg-white rounded-xl"},_e={class:"space-y-4"},Ce=["value"],Ae={class:"flex gap-3 mt-6"},Ie=["disabled"],Se=["disabled"],Me={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50"},Oe={class:"w-full max-w-md p-6 bg-white rounded-xl"},De={class:"space-y-4"},Fe={class:"p-4 rounded-lg bg-blue-50"},He={class:"mt-1 text-2xl font-bold text-blue-600"},Te={class:"flex gap-3 mt-6"},Ve=["disabled"],Le=["disabled"];function Be(s,e,i,c,a,o){const v=I("NavBar");return d(),l("div",D,[A(v),t("div",F,[t("div",H,[t("h2",T," Welcome back, "+r(o.user?.name)+"! ",1),t("p",V,r(o.getCurrentDate()),1)]),t("div",L,[t("div",B,[e[23]||(e[23]=t("h3",{class:"mb-4 text-xl font-semibold text-gray-900"},"Attendance",-1)),o.todayAttendance?(d(),l("div",W,[t("div",z,[t("div",null,[e[13]||(e[13]=t("p",{class:"text-sm text-gray-600"},"Current Status",-1)),t("p",{class:y(["text-2xl font-bold",o.isCheckedIn?"text-green-600":"text-gray-400"])},r(o.isCheckedIn?"Checked In":"Checked Out"),3)]),t("div",{class:y(["flex items-center justify-center w-12 h-12 rounded-full",o.isCheckedIn?"bg-green-100":"bg-gray-100"])},[o.isCheckedIn?(d(),l("svg",j,[...e[14]||(e[14]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])])):(d(),l("svg",N,[...e[15]||(e[15]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)])]))],2)]),o.todayAttendance.check_in_time?(d(),l("div",P,[t("div",U,[e[16]||(e[16]=t("span",{class:"text-gray-600"},"Check In:",-1)),t("span",q,r(o.formatTime(o.todayAttendance.check_in_time)),1)]),o.todayAttendance.check_out_time?(d(),l("div",R,[e[17]||(e[17]=t("span",{class:"text-gray-600"},"Check Out:",-1)),t("span",E,r(o.formatTime(o.todayAttendance.check_out_time)),1)])):u("",!0),o.todayAttendance.check_out_time?(d(),l("div",G,[e[18]||(e[18]=t("span",{class:"text-gray-600"},"Total Hours:",-1)),t("span",J,r(o.calculateHours(o.todayAttendance)),1)])):u("",!0)])):u("",!0)])):u("",!0),t("div",K,[o.isCheckedIn?u("",!0):(d(),l("button",{key:0,onClick:e[0]||(e[0]=n=>a.showCheckInModal=!0),class:"flex items-center justify-center w-full px-4 py-3 font-semibold text-white transition bg-green-600 rounded-lg hover:bg-green-700",disabled:a.loading},[...e[19]||(e[19]=[t("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z","clip-rule":"evenodd"})],-1),f(" Check In ",-1)])],8,Q)),o.isCheckedIn?(d(),l("button",{key:1,onClick:e[1]||(e[1]=n=>a.showCheckOutModal=!0),class:"flex items-center justify-center w-full px-4 py-3 font-semibold text-white transition bg-red-600 rounded-lg hover:bg-red-700",disabled:a.loading},[...e[20]||(e[20]=[t("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 011.414-1.414L9 7.586V4a1 1 0 012 0v3.586l1.293-1.293a1 1 0 011.414 1.414z","clip-rule":"evenodd"})],-1),f(" Check Out ",-1)])],8,X)):u("",!0)]),o.todayAttendance?(d(),l("div",Y,[e[22]||(e[22]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Work Mode",-1)),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.todayAttendance.work_mode=n),onChange:e[3]||(e[3]=(...n)=>o.updateWorkMode&&o.updateWorkMode(...n)),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",disabled:!o.isCheckedIn},[...e[21]||(e[21]=[t("option",{value:"office"},"🏢 Office",-1),t("option",{value:"remote"},"🏠 Remote",-1),t("option",{value:"client_site"},"👥 Client Site",-1),t("option",{value:"ooo"},"🚫 Out of Office",-1)])],40,Z),[[x,o.todayAttendance.work_mode]])])):u("",!0)]),t("div",$,[e[28]||(e[28]=t("h3",{class:"mb-4 text-xl font-semibold text-gray-900"},"This Week",-1)),t("div",ee,[t("div",te,[e[24]||(e[24]=t("p",{class:"text-sm font-medium text-blue-600"},"Days Present",-1)),t("p",se,r(a.stats.daysPresent||0),1)]),t("div",oe,[e[25]||(e[25]=t("p",{class:"text-sm font-medium text-green-600"},"Total Hours",-1)),t("p",ae,r(a.stats.totalHours||0),1)]),t("div",ne,[e[26]||(e[26]=t("p",{class:"text-sm font-medium text-yellow-600"},"Avg. Hours/Day",-1)),t("p",re,r(a.stats.avgHours||0),1)]),t("div",le,[e[27]||(e[27]=t("p",{class:"text-sm font-medium text-purple-600"},"Remote Days",-1)),t("p",de,r(a.stats.remoteDays||0),1)])])])]),t("div",ie,[e[32]||(e[32]=t("h3",{class:"mb-4 text-xl font-semibold text-gray-900"}," Recent Activity ",-1)),a.loading&&!o.recentAttendance.length?(d(),l("div",ce,[...e[29]||(e[29]=[t("div",{class:"inline-block w-8 h-8 border-4 border-blue-500 rounded-full animate-spin border-t-transparent"},null,-1),t("p",{class:"mt-2 text-gray-500"},"Loading...",-1)])])):o.recentAttendance.length===0?(d(),l("div",ue,[...e[30]||(e[30]=[t("svg",{class:"w-12 h-12 mx-auto text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("p",{class:"mt-2"},"No attendance records yet",-1)])])):(d(),l("div",he,[t("table",me,[e[31]||(e[31]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Date "),t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Check In "),t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Check Out "),t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Hours "),t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Mode "),t("th",{class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Status ")])],-1)),t("tbody",ge,[(d(!0),l(p,null,k(o.recentAttendance,n=>(d(),l("tr",{key:n.id,class:"hover:bg-gray-50"},[t("td",ye,r(o.formatDate(n.date)),1),t("td",xe,r(o.formatTime(n.check_in_time)),1),t("td",fe,r(n.check_out_time?o.formatTime(n.check_out_time):"-"),1),t("td",pe,r(n.check_out_time?o.calculateHours(n):"-"),1),t("td",ke,[t("span",{class:y(["px-2 py-1 text-xs rounded-full",o.getWorkModeClass(n.work_mode)])},r(o.getWorkModeLabel(n.work_mode)),3)]),t("td",be,[t("span",{class:y(["px-2 py-1 text-xs rounded-full",n.check_out_time?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},r(n.check_out_time?"Complete":"In Progress"),3)])]))),128))])])]))])]),a.showCheckInModal?(d(),l("div",we,[t("div",ve,[e[40]||(e[40]=t("h3",{class:"mb-4 text-xl font-semibold text-gray-900"},"Check In",-1)),t("div",_e,[t("div",null,[e[34]||(e[34]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Work Mode",-1)),m(t("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>a.checkInForm.work_mode=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...e[33]||(e[33]=[t("option",{value:"office"},"🏢 Office",-1),t("option",{value:"remote"},"🏠 Remote",-1),t("option",{value:"client_site"},"👥 Client Site",-1)])],512),[[x,a.checkInForm.work_mode]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Squad",-1)),m(t("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>a.checkInForm.squad_id=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[e[35]||(e[35]=t("option",{value:""},"Please Choose",-1)),(d(!0),l(p,null,k(o.user.squads,n=>(d(),l("option",{value:n.id},r(n.name),9,Ce))),256))],512),[[x,a.checkInForm.squad_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Event Type (Optional)",-1)),m(t("select",{"onUpdate:modelValue":e[6]||(e[6]=n=>a.checkInForm.event_type=n),class:"w-full px-3 py-2 border border-gray-300 rounded-lg"},[...e[37]||(e[37]=[S('<option value="">Regular Day</option><option value="standup">Daily Standup</option><option value="sprint_planning">Sprint Planning</option><option value="retro">Retrospective</option><option value="demo">Sprint Demo</option>',5)])],512),[[x,a.checkInForm.event_type]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Notes (Optional)",-1)),m(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=n=>a.checkInForm.notes=n),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Any notes for today..."},null,512),[[b,a.checkInForm.notes]])])]),t("div",Ae,[t("button",{onClick:e[8]||(e[8]=n=>a.showCheckInModal=!1),class:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:a.loading}," Cancel ",8,Ie),t("button",{onClick:e[9]||(e[9]=(...n)=>o.handleCheckIn&&o.handleCheckIn(...n)),class:"flex-1 px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700",disabled:a.loading},r(a.loading?"Checking in...":"Check In"),9,Se)])])])):u("",!0),a.showCheckOutModal?(d(),l("div",Me,[t("div",Oe,[e[43]||(e[43]=t("h3",{class:"mb-4 text-xl font-semibold text-gray-900"},"Check Out",-1)),t("div",De,[t("div",null,[e[41]||(e[41]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700"},"Today's Summary (Optional)",-1)),m(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=n=>a.checkOutForm.notes=n),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"What did you accomplish today?"},null,512),[[b,a.checkOutForm.notes]])]),t("div",Fe,[e[42]||(e[42]=t("p",{class:"text-sm text-gray-600"},"Total hours today:",-1)),t("p",He,r(o.calculateCurrentHours()),1)])]),t("div",Te,[t("button",{onClick:e[11]||(e[11]=n=>a.showCheckOutModal=!1),class:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",disabled:a.loading}," Cancel ",8,Ve),t("button",{onClick:e[12]||(e[12]=(...n)=>o.handleCheckOut&&o.handleCheckOut(...n)),class:"flex-1 px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700",disabled:a.loading},r(a.loading?"Checking out...":"Check Out"),9,Le)])])])):u("",!0)])}const je=C(O,[["render",Be]]);export{je as default};
